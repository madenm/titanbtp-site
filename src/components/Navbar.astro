---
const currentPath = Astro.url.pathname;
const links = [
  { href: '/fonctionnalites', label: 'Fonctionnalit√©s' },
  { href: '/#tarifs', label: 'Tarifs' },
  { href: '/contact', label: 'Contact' },
];
---

<nav
  id="navbar"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 group">
        <div
          class="w-9 h-9 rounded-lg bg-primary flex items-center justify-center font-extrabold text-white text-lg"
        >
          T
        </div>
        <span class="text-xl font-bold text-white">
          Titan<span class="text-primary-light">BTP</span>
        </span>
      </a>

      <!-- Desktop links -->
      <div class="hidden md:flex items-center gap-8">
        {
          links.map((link) => (
            <a
              href={link.href}
              class:list={[
                'text-sm font-medium transition-colors hover:text-primary-light',
                currentPath === link.href ? 'text-primary-light' : 'text-gray-300',
              ]}
            >
              {link.label}
            </a>
          ))
        }
      </div>

      <!-- Desktop CTA -->
      <div class="hidden md:flex items-center gap-3">
        <a
          href="https://app.titanbtp.com/auth"
          class="text-sm font-medium text-gray-300 border border-gray-600 rounded-lg px-4 py-2 hover:border-primary-light hover:text-white transition-colors"
        >
          Connexion
        </a>
        <a
          href="https://app.titanbtp.com/auth"
          class="text-sm font-semibold bg-cta hover:bg-cta-dark text-gray-900 rounded-lg px-4 py-2 transition-colors"
        >
          Essai gratuit
        </a>
      </div>

      <!-- Mobile hamburger -->
      <button
        id="menu-toggle"
        class="md:hidden flex flex-col gap-1.5 p-2"
        aria-label="Menu"
        aria-expanded="false"
      >
        <span class="block w-6 h-0.5 bg-white transition-all duration-300 origin-center" id="bar1"></span>
        <span class="block w-6 h-0.5 bg-white transition-all duration-300" id="bar2"></span>
        <span class="block w-6 h-0.5 bg-white transition-all duration-300 origin-center" id="bar3"></span>
      </button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div
    id="mobile-menu"
    class="md:hidden hidden bg-surface-light/95 backdrop-blur-lg border-t border-white/10"
  >
    <div class="px-4 py-4 flex flex-col gap-3">
      {
        links.map((link) => (
          <a
            href={link.href}
            class="text-base font-medium text-gray-300 hover:text-white py-2"
          >
            {link.label}
          </a>
        ))
      }
      <div class="flex flex-col gap-2 pt-3 border-t border-white/10">
        <a
          href="https://app.titanbtp.com/auth"
          class="text-center text-sm font-medium text-gray-300 border border-gray-600 rounded-lg px-4 py-2.5 hover:border-primary-light hover:text-white transition-colors"
        >
          Connexion
        </a>
        <a
          href="https://app.titanbtp.com/auth"
          class="text-center text-sm font-semibold bg-cta hover:bg-cta-dark text-gray-900 rounded-lg px-4 py-2.5 transition-colors"
        >
          Essai gratuit
        </a>
      </div>
    </div>
  </div>
</nav>

<script>
  const navbar = document.getElementById('navbar')!;
  const toggle = document.getElementById('menu-toggle')!;
  const mobileMenu = document.getElementById('mobile-menu')!;
  const bar1 = document.getElementById('bar1')!;
  const bar2 = document.getElementById('bar2')!;
  const bar3 = document.getElementById('bar3')!;

  let menuOpen = false;

  toggle.addEventListener('click', () => {
    menuOpen = !menuOpen;
    mobileMenu.classList.toggle('hidden', !menuOpen);
    toggle.setAttribute('aria-expanded', String(menuOpen));
    bar1.style.transform = menuOpen ? 'rotate(45deg) translate(4px, 4px)' : '';
    bar2.style.opacity = menuOpen ? '0' : '1';
    bar3.style.transform = menuOpen ? 'rotate(-45deg) translate(4px, -4px)' : '';
  });

  const onScroll = () => {
    if (window.scrollY > 20) {
      navbar.classList.add('bg-surface/90', 'backdrop-blur-lg', 'shadow-lg', 'shadow-black/10');
    } else {
      navbar.classList.remove('bg-surface/90', 'backdrop-blur-lg', 'shadow-lg', 'shadow-black/10');
    }
  };
  window.addEventListener('scroll', onScroll, { passive: true });
  onScroll();
</script>
